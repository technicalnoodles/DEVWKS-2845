"use strict";(self.webpackChunkdevwks_2845_client=self.webpackChunkdevwks_2845_client||[]).push([[0],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,h=d["".concat(s,".").concat(m)]||d[m]||k[m]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},9579:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>k,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_position:1},i="Creating a Workflow",l={unversionedId:"xdr-docs/xdr-integration",id:"xdr-docs/xdr-integration",title:"Creating a Workflow",description:"When creating a workflow without using the built in Meraki integraiton, we first need to be able to store the API key in a secure way within XDR, then we can use it in the workflow.",source:"@site/docs/xdr-docs/01-xdr-integration.mdx",sourceDirName:"xdr-docs",slug:"/xdr-docs/xdr-integration",permalink:"/DEVWKS-2845/xdr-docs/xdr-integration",draft:!1,editUrl:"https://cisco.com/docs/xdr-docs/01-xdr-integration.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"XDR Workflow",permalink:"/DEVWKS-2845/category/xdr-workflow"},next:{title:"Testing The Deployment",permalink:"/DEVWKS-2845/testing"}},s={},p=[{value:"Create a Secure Workflow Variable",id:"create-a-secure-workflow-variable",level:2},{value:"Create a Workflow",id:"create-a-workflow",level:2},{value:"JSONPath Query",id:"jsonpath-query",level:3},{value:"Condition Block",id:"condition-block",level:3}],c={toc:p},d="wrapper";function k(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creating-a-workflow"},"Creating a Workflow"),(0,r.kt)("p",null,"When creating a workflow without using the built in Meraki integraiton, we first need to be able to store the API key in a secure way within XDR, then we can use it in the workflow."),(0,r.kt)("h2",{id:"create-a-secure-workflow-variable"},"Create a Secure Workflow Variable"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"After logging into XDR, go to ",(0,r.kt)("strong",{parentName:"p"},"Automate -> Variables"),"\n",(0,r.kt)("img",{alt:"variables",src:a(6855).Z,width:"738",height:"924"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Then click on the ",(0,r.kt)("strong",{parentName:"p"},"+ Nwew Variable")," button on the right side to create a new variables\n",(0,r.kt)("img",{alt:"variables",src:a(2610).Z,width:"3202",height:"810"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the fields of the new variable change them as follows:"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Data Type")," -> ",(0,r.kt)("em",{parentName:"p"},"Secure String"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Display Name")," -> ",(0,r.kt)("em",{parentName:"p"},"[stationNumber]","MerakiKey"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Scope")," -> Environment")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Value")," -> meraki api key from earlier"),(0,r.kt)("p",{parentName:"li"},"It should look similar to the below:\n",(0,r.kt)("img",{alt:"variable filled",src:a(1812).Z,width:"1780",height:"1434"})))),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Save")," on the bottom right."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"save button",src:a(1676).Z,width:"568",height:"324"})))),(0,r.kt)("p",null,"Now we can work on making the workflow"),(0,r.kt)("h2",{id:"create-a-workflow"},"Create a Workflow"),(0,r.kt)("p",null,"To create a workflow, we first need to to go to the workflow editor. Then we can create our workflow."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("strong",{parentName:"li"},"Automate -> Worflows"),(0,r.kt)("img",{alt:"workflows",src:a(4427).Z,width:"728",height:"998"})),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("strong",{parentName:"li"},"Create Workflow")," on the far right of the screen.\n",(0,r.kt)("img",{alt:"create workflow",src:a(2104).Z,width:"3190",height:"666"})),(0,r.kt)("li",{parentName:"ol"},"Leave the ",(0,r.kt)("strong",{parentName:"li"},"Blank Custom Workflow")," selected and click on ","*","*","Continue on the bottom right of the pop up.\n",(0,r.kt)("img",{alt:"blank workflow",src:a(3941).Z,width:"1756",height:"1240"})),(0,r.kt)("li",{parentName:"ol"},"Now we can name the workflow. Please use your workstation ID followed by MerakiWF. It should look like the below example:\n",(0,r.kt)("img",{alt:"name workflow",src:a(806).Z,width:"1100",height:"758"})),(0,r.kt)("li",{parentName:"ol"},"This bring you to a blank workflow like the below:\n",(0,r.kt)("img",{alt:"blank workflow editor",src:a(1919).Z,width:"3454",height:"1500"}))),(0,r.kt)("h3",{id:"jsonpath-query"},"JSONPath Query"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"We need to first be able to read data from the webhook when Meraki sends it. To do this, we can search for ",(0,r.kt)("em",{parentName:"li"},"JSONPath")," in the top left search bar. It should return a ",(0,r.kt)("strong",{parentName:"li"},"JSONPath Query"),". Click and drag it into the workflow editor area. It should look like the below:\n",(0,r.kt)("img",{alt:"blank workflow editor",src:a(6050).Z,width:"2144",height:"1104"})),(0,r.kt)("li",{parentName:"ol"},"We will be changing the data being fed into the ",(0,r.kt)("strong",{parentName:"li"},"JSONPath Query")," later, but for now, we need some dummy data to make sure the workflow is valid. Take the below JSON and paste it into ",(0,r.kt)("strong",{parentName:"li"},"Source JSON to Query")," box on the right side.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "version": "0.1",\n  "sharedSecret": "",\n  "sentAt": "2023-01-13T19:57:07.307562Z",\n  "organizationId": "000000",\n  "organizationName": "EX net",\n  "organizationUrl": "https://n471.meraki.com/o/000000/manage/organization/overview",\n  "networkId": "N_00000000",\n  "networkName": "Ex net",\n  "networkUrl": "https://n471.meraki.com/ex_net/n/000000/manage/nodes/wired_status",\n  "networkTags": [],\n  "deviceSerial": "Q00Y-U00R-T00G",\n  "deviceMac": "00:00:00:d7:14:83",\n  "deviceName": "Home MX",\n  "deviceUrl": "https://n471.meraki.com/ex_net/n/000000/manage/nodes/new_wired_status",\n  "deviceTags": [],\n  "deviceModel": "MX67W",\n  "alertId": "",\n  "alertType": "Switch port disconnected",\n  "alertTypeId": "port_disconnected",\n  "alertLevel": "warning",\n  "occurredAt": "2023-01-13T19:57:07.259607Z",\n  "alertData": {\n    "portNum": 3,\n    "description": "Switch port is down",\n    "status": "down",\n    "prevStatus": "100 Gbps",\n    "portDesc": "Corp Access"\n  }\n}\n')),(0,r.kt)("p",null,"It should look like the below now:\n",(0,r.kt)("img",{alt:"blank workflow editor",src:a(1789).Z,width:"1354",height:"1734"})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Now we need to create 4 ",(0,r.kt)("strong",{parentName:"p"},"JSONPath Queries"),"\n",(0,r.kt)("img",{alt:"blank queries",src:a(5884).Z,width:"846",height:"346"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The first query will be to get the devices serial number. Click on ",(0,r.kt)("strong",{parentName:"p"},"+ Add"),", then fill in the 3 fields like the below:"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"JSONPath Query -> $.deviceSerial"),(0,r.kt)("li",{parentName:"ul"},"Property Name -> deviceSerial"),(0,r.kt)("li",{parentName:"ul"},"Property Type -> String\n",(0,r.kt)("img",{alt:"serial query",src:a(6934).Z,width:"1334",height:"580"}))),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We will repeat this 3 more times for these queries:"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"JSONPath Query"),(0,r.kt)("th",{parentName:"tr",align:null},"Property Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Property Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"$.alertTypeId"),(0,r.kt)("td",{parentName:"tr",align:null},"alertType"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"$.alertData.status"),(0,r.kt)("td",{parentName:"tr",align:null},"portStatus"),(0,r.kt)("td",{parentName:"tr",align:null},"String")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"$.alertData.portNum"),(0,r.kt)("td",{parentName:"tr",align:null},"portNum"),(0,r.kt)("td",{parentName:"tr",align:null},"String")))),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"all queries",src:a(1272).Z,width:"1338",height:"1634"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Now we need to check the box ",(0,r.kt)("strong",{parentName:"p"},"Continue Workflow Execution On Failure"),"\n",(0,r.kt)("img",{alt:"continue",src:a(9978).Z,width:"908",height:"1010"}),"\nWith this done, we can now pass this data to other parts of our workflow."))),(0,r.kt)("h3",{id:"condition-block"},"Condition Block"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We need to check that we got the right type of alert from the webhook and that we got a specific port status. To do that, we can add a ",(0,r.kt)("strong",{parentName:"p"},"Condition Block"),". We can search for ",(0,r.kt)("em",{parentName:"p"},"condition")," in the top left search box and then drag the ",(0,r.kt)("strong",{parentName:"p"},"Condition Block")," item into the editor below the JSONPath Query.\n",(0,r.kt)("img",{alt:"condition block",src:a(3337).Z,width:"2462",height:"1334"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Delete the second ",(0,r.kt)("strong",{parentName:"p"},"Condition Branch")," by clicking on the 3 dots on the top right of it and selecting ",(0,r.kt)("strong",{parentName:"p"},"Delete"),"\n",(0,r.kt)("img",{alt:"branch delete",src:a(5484).Z,width:"388",height:"294"}),"\nNow we should have something similar to the below:\n",(0,r.kt)("img",{alt:"single branch",src:a(6387).Z,width:"836",height:"1062"})))))}k.isMDXComponent=!0},1272:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/all-queries-11bec740477bffc35819f3853606686c.png"},5884:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/blank-queries-ef98b5b9c40fae3e335d80d37631bbd0.png"},1919:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/blank-workflow-editor-0eaec299c41f52d15cacae3ab2952798.png"},3941:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/blank-workflow-8a60dc697f2a7c94afb920896ed7aa91.png"},5484:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/branch-delete-c1de3494720c80676c0f683b0a37e23b.png"},3337:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/condition-block-aad73bc83187e77f90e4810f7064fc40.png"},9978:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/continue-workflow-b5fc0f0120c221d5bbfb9a8115d8e992.png"},2104:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/create-workflow-065302d3335d20bdebfe0af696573f3d.png"},6934:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/device-serial-4e33f6824a0a2a712aa5003d4123f591.png"},6050:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/json-path-query-e10d083e9ab27f3586219adb5111c49e.png"},806:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/name-workflow-31052efa7f9929173dbe1c0840dd10c4.png"},2610:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/new-variable-5850df577025d063d4779753610434db.png"},1789:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/paste-json-ef361a6ac57e0bcda69f728cd20b6420.png"},1676:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/save-bac410e710ebe2a192d28b8b4d9433dc.png"},6387:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/single-condition-85ec8b0b46ccd57ba184e0821b672f92.png"},1812:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/variable-filled-f95ba025b44620a9a58c8d6409b608cb.png"},6855:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/variables-7f4a5afdd60da13a1cceb456cea23a6e.png"},4427:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/workflows-page-d3f0a22dbc4ed7fbba691151c19e85eb.png"}}]);